<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 Live Gallery</title>
    <style>
        * { box-sizing: border-box; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; position: fixed; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: block; }
        
        /* UI ç»å¯¹å®šä½åœ¨å·¦ä¸Šè§’ */
        #ui { 
            position: absolute; top: 30px; left: 20px; 
            z-index: 10; pointer-events: none;
            font-family: sans-serif;
        }
        .year { 
            font-size: 14vw; font-weight: 900; color: rgba(255,215,0,0.3);
            margin: 0; line-height: 1;
        }
        #status {
            margin-top: 10px; color: #fff; font-size: 12px;
            background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px;
            display: inline-block; letter-spacing: 1px;
        }
        video { display: none; }
    </style>
</head>
<body>
    <div id="ui">
        <h1 class="year">2026</h1>
        <div id="status">ç‚¹å‡»å±å¹•å¼€å§‹äº¤äº’</div>
    </div>
    <canvas id="c"></canvas>
    <video id="v" playsinline></video>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status');
        let w, h, dpr, photos = [], particles = [];
        let handX = 0, handY = 0, isHandVisible = false, isPinching = false;
        let globalTime = 0;

        function resize() {
            w = window.innerWidth; h = window.innerHeight;
            dpr = window.devicePixelRatio || 1;
            canvas.width = w * dpr; canvas.height = h * dpr;
            ctx.scale(dpr, dpr);
        }

        // ç®€å•çš„èƒŒæ™¯ç²’å­ï¼ˆæµæ˜Ÿæ•ˆæœï¼‰ï¼Œç¡®ä¿ç”»é¢ä¸â€œæ­»â€
        class Star {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * w; this.y = Math.random() * h;
                this.v = 0.5 + Math.random() * 1.5; this.len = 10 + Math.random() * 20;
            }
            update() {
                this.x -= this.v; this.y += this.v * 0.5;
                if (this.x < -20 || this.y > h + 20) this.reset();
            }
            draw() {
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.beginPath(); ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x + this.len, this.y - this.len * 0.5);
                ctx.stroke();
            }
        }

        function animate() {
            globalTime++;
            ctx.fillStyle = '#05050a';
            ctx.fillRect(0, 0, w, h);

            // 1. ç»˜åˆ¶èƒŒæ™¯åŠ¨æ€æµæ˜Ÿ
            particles.forEach(p => { p.update(); p.draw(); });

            // 2. ç»˜åˆ¶ç…§ç‰‡å¢™ï¼ˆå·¦ä¸Šè§’å¯¹é½ï¼‰
            if (photos.length > 0) {
                // å¦‚æœæ²¡æœ‰æ‰‹ï¼Œç…§ç‰‡ä¼šéšæ—¶é—´å¾®å¼±æ¼‚æµ®
                let activeIdx = isHandVisible ? handX * photos.length : -1;
                
                photos.forEach((pData, i) => {
                    let diff = Math.abs(i - activeIdx);
                    let focus = isHandVisible ? Math.max(0, 1 - diff * 0.8) : 0;
                    
                    // åŸºç¡€ä½ç½®ï¼šå·¦ä¸Šè§’å †å 
                    let baseX = 40 + i * 15;
                    let baseY = 150 + i * 10;
                    
                    // åŠ¨æ€åç§»ï¼šå¦‚æœæ²¡æœ‰æ‰‹ï¼Œå°±éšæ—¶é—´æ‘†åŠ¨ï¼›æœ‰æ‰‹å°±è·Ÿæ‰‹
                    let offsetX = Math.sin(globalTime * 0.02 + i) * 10;
                    let offsetY = Math.cos(globalTime * 0.02 + i) * 10;
                    
                    if (isHandVisible) {
                        offsetX += focus * 50; 
                        offsetY += focus * 20;
                    }

                    ctx.save();
                    ctx.translate(baseX + offsetX, baseY + offsetY);
                    
                    // ç¼©æ”¾é€»è¾‘
                    let scale = (w < 600 ? 0.25 : 0.4) + (focus * 0.3);
                    if (isPinching && focus > 0.8) scale *= 1.8; // æåˆæ”¾å¤§

                    ctx.globalAlpha = isHandVisible ? (0.3 + focus * 0.7) : 0.4;
                    ctx.shadowColor = 'rgba(0,0,0,0.5)';
                    ctx.shadowBlur = 10;
                    
                    let imgW = pData.img.width * scale;
                    let imgH = pData.img.height * scale;
                    
                    // ç»˜åˆ¶ç…§ç‰‡
                    ctx.drawImage(pData.img, 0, 0, imgW, imgH);
                    
                    // ç»™é€‰ä¸­çš„ç…§ç‰‡åŠ ä¸ªè¾¹æ¡†
                    if (focus > 0.5) {
                        ctx.strokeStyle = `rgba(255,215,0,${focus})`;
                        ctx.lineWidth = 2;
                        ctx.strokeRect(0, 0, imgW, imgH);
                    }
                    ctx.restore();
                });
            }

            requestAnimationFrame(animate);
        }

        async function initAI() {
            const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
            hands.setOptions({maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.5});
            hands.onResults(res => {
                if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                    isHandVisible = true;
                    const lm = res.multiHandLandmarks[0];
                    handX = 1 - lm[9].x; 
                    handY = lm[9].y;
                    
                    // åˆ¤å®šå¼ å¼€ä¸æåˆ
                    const openLevel = Math.hypot(lm[12].x-lm[0].x, lm[12].y-lm[0].y);
                    const pinchDist = Math.hypot(lm[8].x-lm[4].x, lm[8].y-lm[4].y);
                    isPinching = pinchDist < 0.05;
                    
                    statusEl.innerText = isPinching ? "ğŸ” æ­£åœ¨æ”¾å¤§æŸ¥çœ‹" : "ğŸ‘‹ å·²è¯†åˆ«ï¼šå·¦å³ç§»åŠ¨åˆ‡æ¢";
                    statusEl.style.background = "rgba(0,255,0,0.2)";
                } else {
                    isHandVisible = false;
                    statusEl.innerText = "â³ å¯»æ‰¾æ‰‹æŒä¸­...";
                    statusEl.style.background = "rgba(255,255,255,0.1)";
                }
            });

            const cam = new Camera(document.getElementById('v'), {
                onFrame: async () => { await hands.send({image: document.getElementById('v')}); },
                width: 480, height: 640
            });

            window.addEventListener('touchstart', () => {
                statusEl.innerText = "ğŸ“· ç›¸æœºå¯åŠ¨ä¸­...";
                cam.start();
            }, {once: true});
        }

        // å¯åŠ¨
        resize();
        window.addEventListener('resize', resize);
        for(let i=0; i<20; i++) particles.push(new Star());
        
        // åŠ è½½å›¾ç‰‡
        let loaded = 0;
        for(let i=1; i<=13; i++) {
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.src = `mj/${i}.jpg`;
            img.onload = () => { if(++loaded === 13) { initAI(); animate(); } };
        }
    </script>
</body>
</html>
